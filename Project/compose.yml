services:
  devui:
    image: cybersec-agent-devui
    container_name: cybersec-agent-devui
    working_dir: /app

    volumes:
      - .:/app
      - /app/.venv

    ports:
      - "8080:8080"
      - "8787:8787"

    env_file:
      - .env

    environment:
      API_BASE_URL: "https://openrouter.ai/api/v1"
      # Using Llama 3.3 for stability
      MODEL: "meta-llama/llama-3.3-70b-instruct"
      ENABLE_OTEL: "true"
      AGENT_NAME: "LARS-fleet-server"

    # --- UPDATED COMMAND ---
    # Added 'bokeh>=3.1.0' to the install list
    command: >
      /bin/sh -c "uv pip install 'dask[distributed]' 'bokeh>=3.1.0' && uv run devui /app --host 0.0.0.0 --port 8080"